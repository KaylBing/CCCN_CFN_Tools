---
title: "RCy3 Plotting of CCCN and CFN "
output: github_document
Author: "Mark Grimes
        University of Montana"
---
Note: 'biocLite' is deprecated.
Use 'BiocManager::install' instead.
---
# Lung cancer plus ten cell line data
# August 12, 2019
# Mark Grimes
---
# Note: Cytoscape 3.7.1 or greater is required. Start Cytoscape and make sure cyREST is activated before running this script.
# This loads MGs packages and functions and lists the data objects from the new data:
```{r}
# # ------------------------------------------------------------------------
# To UpDATE
# source("http://www.bioconductor.org/biocLite.R")
# biocLite("RCy3")
# biocLite("BiocStyle")
# Try the latest version of RCy3 by running:
    # install.packages("BiocManager")
    #   BiocManager::install("RCy3")
library(devtools)
library(RCy3)
library(plyr)
library(dplyr)
library(RColorBrewer)
library(gplots)
library(igraph)
library(knitr)
library("BiocStyle")
options(stringsAsFactors=FALSE)
#
# There are several resources available:
browseVignettes('RCy3')
# https://github.com/cytoscape/RCy3/wiki/Upgrading-Existing-Scripts
# 
#MAY 19th make a change
# Note: Start Cytoscape
# ------------------------------------------------------------------------
cytoscapePing ()
cytoscapeVersionInfo ()

```
---

---
```{r load data objects and functions}
 options(stringsAsFactors=FALSE)
options(stringsAsFactors=FALSE)
data_path <- "C:/Users/yulin/Desktop/Multi-PTM Analysis-Summer Students/RDataFiles/"
code_path <- "C:/Users/yulin/Documents/Bioinformatics/SUMMER_GIT/PTMs-to-CCCN-and-CFN5_19/"
load(file=paste(data_path, "KGFunDataObjects.RData", sep=""))
load(file=paste(data_path, "LC_TMT_Nets.RData", sep=""))
load(file=paste(data_path, "TenCell.RData", sep=""))
load(file=paste(data_path, "GZ_PPI_Networks2.RData", sep=""))
load(file=paste(data_path, "LD_NewCFNCCCN_Networks.RData", sep=""))
load(file=paste(data_path,"drug_effects.RData", sep=""))
	source(paste(code_path, "Data_Input_Formatting.R", sep=""))
	source(paste(code_path, "Dissimilarity_Calculations.R", sep=""))
	source(paste(code_path, "Generate_CCCN_CFN.R", sep=""))
    source(paste(code_path, "CFN_CCCN_Analysis.R", sep=""))
if (!cytoscapePing()=="You are connected to Cytoscape!") {
     print("Turn on Cytoscape to load New_RCy3_Functions.R")}

```

#This chunk selects sites from an experiment with absolute fold-change greater than a specified value. Then it computes the shortest paths in the CFN from the selected sites to a specified target (e.g, the drug target). Then it computes and draws the union and intersection of the shortest paths networks and draws the networks. PC9/erlotinib is used as an example.  
```{r shortest paths to target for PC9/erlotinib-independent experiments method}
#There are 5 PC9/erlotinib experiments ("PC9SEPTM.E1.ratio", "PC9SEPTM.E2.ratio", "PC9SEPTM.E3.ratio", "PC9_Erlotinib.1Ratio", "PC9_ErlotinibRatio"). For each experiment select sites that have abs fold-change > 2.25-fold. Then find the shortest paths to EGFR.

selected_sites_S1 <- select.sites.w.min.value(gz.cf, "PC9SEPTM.E1.ratio", min_value = 2.25)
paths_S1 <- shortest.paths.to.target(selected_sites_S1, target = "EGFR")

selected_sites_S2 <- select.sites.w.min.value(gz.cf, "PC9SEPTM.E2.ratio", min_value = 2.25)
paths_S2 <- shortest.paths.to.target(selected_sites_S2, target = "EGFR")

selected_sites_S3 <- select.sites.w.min.value(gz.cf, "PC9SEPTM.E3.ratio", min_value = 2.25)
paths_S3 <- shortest.paths.to.target(selected_sites_S3, target = "EGFR")

selected_sites_T1 <- select.sites.w.min.value(gz.cf, "PC9_Erlotinib.1Ratio", min_value = 2.25)
paths_T1 <- shortest.paths.to.target(selected_sites_T1, target = "EGFR")

selected_sites_T2 <- select.sites.w.min.value(gz.cf, "PC9_ErlotinibRatio", min_value = 2.25)
paths_T2 <- shortest.paths.to.target(selected_sites_T2, target = "EGFR")

#Find the union of shortest paths networks for the three SEPTM experiments and draw the network
S_union <- my.union(paths_S1, paths_S2, paths_S3)
union_network <- graph.cfn.cccn (S_union, ld=FALSE, gz=TRUE, only.cfn=TRUE)
all.ratio.styles()

#Find the intersection of shortest paths networks for the three SEPTM experiments
S_intersect <- my.intersect(paths_S1, paths_S2, paths_S3)
intersect_network <- graph.cfn.cccn (S_intersect, ld=FALSE, gz=TRUE, only.cfn=TRUE)
all.ratio.styles()

```  
# Cell line are matched to the interested drug-target
# The gz.cf is the node list
# The fold-change is abs(2.25) to acquire greatly changed molecules
# This is the part for distance heatmap
```{r}

# cell line = H3122, ExpSet = SEPTM, Drug = Crizotinib, rep = 3

ss1 <- select.sites.w.min.value(gz.cf, "H3122SEPTM.C1.ratio", min_value = 2.25)
paths_1 <- shortest.paths.to.target(ss1, target = "ALK")

ss2 <- select.sites.w.min.value(gz.cf, "H3122SEPTM.C2.ratio", min_value = 2.25)
paths_2 <- shortest.paths.to.target(ss2, target = "ALK")

ss3 <- select.sites.w.min.value(gz.cf, "H3122SEPTM.C3.ratio", min_value = 2.25)
paths_3 <- shortest.paths.to.target(ss3, target = "ALK")


# cell line = H3122, ExpSet = TenCell, Drug = Crizotinib, rep = 2

ss4 <- select.sites.w.min.value(gz.cf, "H3122_Crizotinib.1Ratio", min_value = 2.25)
paths_4 <- shortest.paths.to.target(ss4, target = "ALK")

ss5 <- select.sites.w.min.value(gz.cf, "H3122CrizotinibRatio", min_value = 2.25)
paths_5 <- shortest.paths.to.target(ss5, target = "ALK")


# cell line = HCC78, ExpSet = TenCell, Drug = Crizotinib, rep = 2

ss6 <- select.sites.w.min.value(gz.cf, "HCC78_Crizotinib.1Ratio", min_value = 2.25)
paths_6 <- shortest.paths.to.target(ss6, target = "ROS1")

ss7 <- select.sites.w.min.value(gz.cf, "HCC78_CrizotinibRatio", min_value = 2.25)
paths_7 <- shortest.paths.to.target(ss7, target = "ROS1")


# cell line = STE.1, ExpSet = TenCell, Drug = Crizotinib, rep = 1

ss8 <- select.sites.w.min.value(gz.cf, "STE.1_CrizotinibRatio", min_value = 2.25)
paths_8 <- shortest.paths.to.target(ss8, target = "ALK")


# cell line = H2228, ExpSet = TenCell, Drug = Crizotinib, rep = 1

ss9 <- select.sites.w.min.value(gz.cf, "H2228CrizotinibRatio", min_value = 2.25)
paths_9 <- shortest.paths.to.target(ss9, target = "ALK")


# cell line = PC9, ExpSet = SEPTM, Drug = Erlotinib, rep = 3

ss10 <- select.sites.w.min.value(gz.cf, "PC9SEPTM.E1.ratio", min_value = 2.25)
paths_10 <- shortest.paths.to.target(ss10, target = "EGFR")

ss11 <- select.sites.w.min.value(gz.cf, "PC9SEPTM.E2.ratio", min_value = 2.25)
paths_11 <- shortest.paths.to.target(ss11, target = "EGFR")

ss12 <- select.sites.w.min.value(gz.cf, "PC9SEPTM.E3.ratio", min_value = 2.25)
paths_12 <- shortest.paths.to.target(ss12, target = "EGFR")

# cell line = PC9, ExpSet = TenCell, Drug = Erlotinib, rep = 2

ss13 <- select.sites.w.min.value(gz.cf, "PC9_Erlotinib.1Ratio", min_value = 2.25)
paths_13 <- shortest.paths.to.target(ss13, target = "EGFR")

ss14 <- select.sites.w.min.value(gz.cf, "PC9_ErlotinibRatio", min_value = 2.25)
paths_14 <- shortest.paths.to.target(ss14, target = "EGFR")

# cell line = HCC4006, ExpSet = TenCell, Drug = Erlotinib, rep = 1

ss15 <- select.sites.w.min.value(gz.cf, "HCC4006_ErlotinibRatio", min_value = 2.25)
paths_15 <- shortest.paths.to.target(ss15, target = "EGFR")

# cell line = HCC827, ExpSet = TenCell, Drug = Erlotinib, rep = 1

ss16 <- select.sites.w.min.value(gz.cf, "HCC827_ErlotinibRatio", min_value = 2.25)
paths_16 <- shortest.paths.to.target(ss16, target = "EGFR")


##### PR171
# cell line = H3122, ExpSet = SEPTM, Drug = PR171， rep = 3

ss17 <- select.sites.w.min.value(gz.cf, "H3122SEPTM.PR1.ratio", min_value = 2.25)
paths_17 <- shortest.paths.to.target(ss17, target = "")

ss18 <- select.sites.w.min.value(gz.cf, "H3122SEPTM.PR2.ratio", min_value = 2.25)
paths_18 <- shortest.paths.to.target(ss18, target = "")

ss19 <- select.sites.w.min.value(gz.cf, "H3122SEPTM.PR3.ratio", min_value = 2.25)
paths_19 <- shortest.paths.to.target(ss19, target = "")

# cell line = PC9, ExpSet = SEPTM, Drug = PR171， rep = 3

ss20 <- select.sites.w.min.value(gz.cf, "PC9SEPTM.PR1.ratio", min_value = 2.25)
paths_20 <- shortest.paths.to.target(ss20, target = "")

ss21 <- select.sites.w.min.value(gz.cf, "PC9SEPTM.PR2.ratio", min_value = 2.25)
paths_21 <- shortest.paths.to.target(ss21, target = "")

ss22 <- select.sites.w.min.value(gz.cf, "PC9SEPTM.PR3.ratio", min_value = 2.25)
paths_22 <- shortest.paths.to.target(ss22, target = "")


# cell line = H2286, ExpSet = TenCell, Drug = Dasatinib， rep = 1

ss23 <- select.sites.w.min.value(gz.cf, "H2286_DasatinibRatio", min_value = 2.25)
paths_23 <- shortest.paths.to.target(ss23, target = "")

# cell line = H366, ExpSet = TenCell, Drug = Dasatinib， rep = 1

ss24 <- select.sites.w.min.value(gz.cf, "H366_DasatinibRatio", min_value = 2.25)
paths_24 <- shortest.paths.to.target(ss24, target = "")


# cell line = H1781, ExpSet = TenCell, Drug = Afatinib， rep = 1

ss25 <- select.sites.w.min.value(gz.cf, "H1781_AfatinibRatio", min_value = 2.25)
paths_25 <- shortest.paths.to.target(ss25, target = "ERBB2")

# The table for the cell line, Experiment set, Drug etc.
gz_experiments_df <- read.csv("gz_experiments.csv")
```
# The union and intersection or single path network

# Paired union and intersection and generate the ratio. 

```{r}
# Paired Union
sample_order_l <- c(1, 2, 3, 4, 5, 8, 9, 10, 11, 12, 13, 14, 15, 16, 25)

# Uni_i_j <- my.union(paths_i,paths_j)
for (i in sample_order_l){
  for (j in sample_order_l){
    assign(paste("Uni",i,j,sep = "_"), my.union(get(paste("paths_",i,sep = "")),get(paste("paths_",j,sep = ""))))
   }
}

# Paired Intersection

# Inters_i_j <- my.intersect(paths_i,paths_j)
for (i in sample_order_l){
  for (j in sample_order_l){
    assign(paste("Inters",i,j,sep = "_"), my.intersect(get(paste("paths_",i,sep = "")),get(paste("paths_",j,sep = ""))))
   }
}

# The ratio = nrow(Inters_i_j)/nrow(Uni_i_j)
for (i in sample_order_l){
  for (j in sample_order_l){
    assign(paste("Ratio",i,j,sep = "_"), nrow(get(paste("Inters",i,j,sep = "_")))/nrow(get(paste("Uni",i,j,sep = "_"))))
   }
}


# 15*15 ratio dataframe 
ratio_df <- list()
for (i in sample_order_l){
  for (j in sample_order_l){
    assign("ratio_df", append(ratio_df,get(paste("Ratio",i,j,sep = "_"))))
  }
}

ratio_df <- as.numeric(ratio_df)
ratio_mat <- matrix(ratio_df,nrow = 15,ncol = 15)
ratio_dataframe <- as.data.frame(ratio_mat)


sample_15 <- c("ss1",
"ss2",
"ss3",
"ss4",
"ss5",
"ss8",
"ss9",
"ss10",
"ss11",
"ss12",
"ss13",
"ss14",
"ss15",
"ss16",
"ss25")

gz_exp_15_df <- gz_experiments_df[sample_order_l,]
gz_exp_15_df <- gz_exp_15_df[,2:5]
target_l <- c("ALK","ALK","ALK","ALK","ALK","ALK","ALK",
              "EGFR","EGFR","EGFR","EGFR","EGFR","EGFR","EGFR"
              ,"ERBb2")
gz_exp_15_df$target <- target_l
gz_exp_15_df$merge <- paste(gz_exp_15_df$CellLine,gz_exp_15_df$ExpSet,gz_exp_15_df$Drug,gz_exp_15_df$target,gz_exp_15_df$Rep,sep = "_")

colnames(ratio_dataframe) <- gz_exp_15_df$merge
rownames(ratio_dataframe) <- gz_exp_15_df$merge

# The following code brings in the extra annotative information about the drug and cell line and target.


Cell <- factor(gz_exp_15_df$CellLine,labels = unique(gz_exp_15_df$CellLine))


Drug <- factor(gz_exp_15_df$Drug,levels = unique(gz_exp_15_df$Drug))


Target <- factor(gz_exp_15_df$target,levels = unique(gz_exp_15_df$target))

ann_colors = list(Cell = c(H3122="#CC9999",STE.1="#CCCC99",H2228="#FFFF99",PC9="#CCCCFF",HCC4006="#666666",HCC827="#FF6666",H1781="#99CC66"),Drug = c(Crizotinib="#99CCCC",Erlotinib="#FF9999",Afatinib="#FFCC99"),Target = c(ALK="#FFFFCC",EGFR="#CCCCFF",ERBb2="#CCFFFF"))
annotation<-data.frame(Cell,Drug,Target)
rownames(annotation) <- rownames(ratio_dataframe)

pheatmap::pheatmap(ratio_dataframe,annotation = annotation,annotation_colors = ann_colors)



```
# As the rown() acturally counts each correlation (source to target) realtionship, there must be many duplicated counting of nodes.
# The following heatmap is based on the nodes/gene dependet counting and hopefully this would generate a approximal heatmap to what we already have.
```{r}
#This counts the node number of in the network.
node_number_counting <- function(node_list){
  len <- length(union(unique(node_list$target),unique(node_list$source)))
  return(len)
}

# Node count list for the unions NLU, Node count list for intersection NLI
NLU <- list()
NLI <- list()
for (i in sample_order_l){
  for (j in sample_order_l){
    assign("NLU", append(NLU,node_number_counting(get(paste("Uni",i,j,sep = "_")))))
    assign("NLI", append(NLI,node_number_counting(get(paste("Inters",i,j,sep = "_")))))
  }
}

NLU <- as.numeric(NLU)
NLI <- as.numeric(NLI)

node_ratio_list <- list()

for (i in 1:225){
  assign("node_ratio_list", append(node_ratio_list, NLI[i]/NLU[i]))
}

node_ratio_list <- as.numeric(node_ratio_list)
node_ratio_mat <- matrix(node_ratio_list,nrow = 15,ncol = 15)
node_ratio_df <- data.frame(node_ratio_mat)

colnames(node_ratio_df) <- gz_exp_15_df$merge
rownames(node_ratio_df) <- gz_exp_15_df$merge
pheatmap::pheatmap(node_ratio_df, annotation= annotation)

```


# This chunk selects sites for a particular cell line/drug combo that meet criteria for minimum number of observations, minimum absolute value of mean for the ratio, and maximun coefficient of variation for the ratio. Then it computes the shortest paths in the CFN from the selected sites to a specified target (e.g, the drug target) and draws the network. PC9/erlotinib is used as an example.  

```{r shortest paths to target for PC9/erlotinib-mean/CV method}
#There are 5 PC9/erlotinib experiments (3 from SEPTM and 2 from TenCellLines). Select sites that (i) have observed values in at least two experiments; (ii) have mean change of at least 2.25-fold; (iii) have a "small" standard deviation. Calculate the coefficient of variation for log-transformed data (https://en.wikipedia.org/wiki/Coefficient_of_variation). Select sites with CV<=1.

all_cols <- colnames(gz.cf)
all_cols

#Make a dataframe with just the following columns from gz.cf: id, Gene.Name and the 5 PC9/Erlotinib data columns
desired_cols <- c("id", "Gene.Name", "PC9SEPTM.E1.ratio", "PC9SEPTM.E2.ratio", "PC9SEPTM.E3.ratio", "PC9_Erlotinib.1Ratio", "PC9_ErlotinibRatio")

#Select the rows that have at least 2 (non-NA) observations
gz_pc9_erl.cf <- gz.cf[desired_cols]
gz_pc9_erl_keep.cf <- select.sites.w.enough.obs(gz_pc9_erl.cf, num_rep = 5, min_obs = 2)
nrow(gz_pc9_erl_keep.cf)

#Calculate the mean and keep only those rows with abs(mean) > log2(2.25)
gz_pc9_erl_keep2.cf <- select.sites.w.min.mean(gz_pc9_erl_keep.cf, first_rep = 3, num_rep = 5, min_mean = 2.25)
nrow(gz_pc9_erl_keep2.cf)

#Calculate the log-transformed coefficient of variation for each row and keep only rows with CV <=1
gz_pc9_erl_keep2.cf <- select.sites.w.max.cv(gz_pc9_erl_keep2.cf, first_rep = 3, num_rep =5, max_cv = 1)
nrow(gz_pc9_erl_keep2.cf)

#Now compute the shortest paths network for this set of sites and make Cytoscape graph.
gz_pc9_erl_keep2_paths <- shortest.paths.to.target(gz_pc9_erl_keep2.cf, target = "EGFR")
nrow(gz_pc9_erl_keep2_paths)
changed_genes_network <- graph.cfn.cccn (gz_pc9_erl_keep2_paths, ld=FALSE, gz=TRUE, only.cfn=TRUE)
all.ratio.styles()


```  
# use the identical method to measure the H3122 cell lines sets
```{r}
#Make a dataframe with just the following columns from gz.cf: id, Gene.Name and the 5 H3122/Crizotinib data columns
desired_cols2 <- c("id", "Gene.Name", "H3122SEPTM.C1.ratio", "H3122SEPTM.C2.ratio", "H3122SEPTM.C3.ratio", "H3122_Crizotinib.1Ratio", "H3122CrizotinibRatio")

#Select the rows that have at least 2 (non-NA) observations
gz_H3_CRI.cf <- gz.cf[desired_cols2]
gz_H3_CRI_keep.cf <- select.sites.w.enough.obs(gz_H3_CRI.cf, num_rep = 5, min_obs = 2)
nrow(gz_H3_CRI_keep.cf)

#Calculate the mean and keep only those rows with abs(mean) > log2(2.25)
gz_pc9_erl_keep2.cf <- select.sites.w.min.mean(gz_pc9_erl_keep.cf, first_rep = 3, num_rep = 5, min_mean = 2.25)
nrow(gz_pc9_erl_keep2.cf)

#Calculate the log-transformed coefficient of variation for each row and keep only rows with CV <=1
gz_H3_CRI_keep2.cf <- select.sites.w.max.cv(gz_H3_CRI_keep2.cf, first_rep = 3, num_rep =5, max_cv = 1)
nrow(gz_H3_CRI_keep2.cf)

#Now compute the shortest paths network for this set of sites and make Cytoscape graph.
gz_H3_CRI_keep2_paths <- shortest.paths.to.target(gz_H3_CRI_keep2.cf, target = "EGFR")
nrow(gz_H3_CRI_keep2_paths)
changed_genes_network <- graph.cfn.cccn (gz_pc9_erl_keep2_paths, ld=FALSE, gz=TRUE, only.cfn=TRUE)
all.ratio.styles()


```


# Heatmap comparison of shortest paths network
# Assumptions: In SPN, each nodes is a representative maker for the impact of drug (if no change, then no drug effect)
# Based on this assumpation, a target-based comparison would make more biological sense and give more clue about the overlapping pahtways
# target = MET/HGFR
```{r}
# MET_paths_i <- shortest.paths.to.target(ssi,target = "MET")
for (i in 1:25){
  assign(paste("MET_paths_",i, sep = ""), shortest.paths.to.target(get(paste("ss", i, sep="")), target = "MET"))
}

# MET_intercet is the intersection of 25 MET targeting samples
for (i in 1:25){
  MET_intercet <- my.intersect(get(paste("MET_paths_",i,sep = "")))
}

MET_Network <- graph.cfn.cccn (MET_intercet, ld=FALSE, gz=TRUE, only.cfn=TRUE)
all.ratio.styles()

# MET_i_nrow_ratio <- nrow(MET_paths_i)/nrow(MET_intercet)
for (i in 1:25){
  assign(paste("MET_",i,"_nrow_ratio", sep = ""),nrow(get(paste("MET_paths_",i,sep = "")))/nrow(MET_intercet))
}

# MET_ratios <- list(MET_i_nrow_ratio)
MET_ratios <- list()
for (i in 1:25){
  assign("MET_ratios", append(MET_ratios,get(paste("MET_",i,"_nrow_ratio", sep = ""))))
}



#creatign a dataframe to generate the heatmap
MET_dataframe <- data.frame(MET_ratios)
colnames(MET_dataframe) <- cell_line
write.table(MET_dataframe,"MET.txt")
MET <-read.csv("MET.csv")
rownames(MET) <- cell_line
colnames(MET) <- cell_line
MET <- MET[2:26]
pheatmap::pheatmap(MET)

```
# Paried/ same target/ shortest path analysis
# target = MET
```{r}

# pairwise comparison in for single target function

# MET_Uni_i_j <- my.union(paths_i,paths_j)
for (i in 1:25){
  for (j in 1:25){
    assign(paste("MET_Uni",i,j,sep = "_"), my.union(get(paste("MET_paths_",i,sep = "")),get(paste("MET_paths_",j,sep = ""))))
   }
}



# MET_Inters_i_j <- my.intersect(MET_paths_i,paths_j)
for (i in 1:25){
  for (j in 1:25){
    assign(paste("MET_Inters",i,j,sep = "_"), my.intersect(get(paste("MET_paths_",i,sep = "")),get(paste("MET_paths_",j,sep = ""))))
   }
}

# The MET_paired_ratio_i_j = nrow(MET_Inters_i_j)/nrow(MET_Uni_i_j)
for (i in 1:25){
  for (j in 1:25){
    assign(paste("MET_paired_ratio",i,j,sep = "_"), nrow(get(paste("MET_Inters",i,j,sep = "_")))/nrow(get(paste("MET_Uni",i,j,sep = "_"))))
   }
}

#
MET_paired_ratio_df <- list()
for (i in 1:25){
  for (j in 1:25){
    assign("MET_paired_ratio_df",append(MET_paired_ratio_df,get(paste("MET_paired_ratio",i,j,sep = "_"))))
    }
}

write.table(MET_paired_ratio_df, "MET_paired_ratio_df.txt")


MET_ratio_dataframe <- read.csv("MET_paired_ratio_df.csv",header = FALSE)

sample_25 <- list()
for (i in 1:25){
  assign("sample_25",append(sample_25,paste("ss",i,sep = "")))
}

colnames(MET_ratio_dataframe) <- cell_line
rownames(MET_ratio_dataframe) <- cell_line
pheatmap::pheatmap(MET_ratio_dataframe)
```

```{r}
#nod number counting on MET

```



# target = EGFR
```{r}
# EGFR_paths_i <- shortest.paths.to.target(ssi,target = "EGFR")
for (i in 1:25){
  assign(paste("EGFR_paths_",i, sep = ""), shortest.paths.to.target(get(paste("ss", i, sep="")), target = "EGFR"))
}

# EGFR_intercet is the intersection of 25 EGFR targeting samples
for (i in 1:25){
  EGFR_intercet <- my.intersect(get(paste("EGFR_paths_",i,sep = "")))
}

EGFR_Network <- graph.cfn.cccn (EGFR_intercet, ld=FALSE, gz=TRUE, only.cfn=TRUE)
all.ratio.styles()

# EGFR_i_nrow_ratio <- nrow(EGFR_paths_i)/nrow(EGFR_intercet)
for (i in 1:25){
  assign(paste("EGFR_",i,"_nrow_ratio", sep = ""),nrow(get(paste("EGFR_paths_",i,sep = "")))/nrow(EGFR_intercet))
}

# EGFR_ratios <- list(EGFR_i_nrow_ratio)
EGFR_ratios <- list()
for (i in 1:25){
  assign("EGFR_ratios", append(EGFR_ratios,get(paste("EGFR_",i,"_nrow_ratio", sep = ""))))
}



#creatign a dataframe to generate the heatmap
EGFR_dataframe <- data.frame(EGFR_ratios)
colnames(EGFR_dataframe) <- cell_line
write.table(EGFR_dataframe,"EGFR.txt")
EGFR <-read.csv("EGFR.csv")
rownames(EGFR) <- cell_line
colnames(EGFR) <- cell_line
EGFR <- EGFR[2:26]
pheatmap::pheatmap(EGFR)

```
# Paried/ same target/ shortest path analysis
# target = EGFR

```{r}

# EGFR_Uni_i_j <- my.union(paths_i,paths_j)
for (i in 1:25){
  for (j in 1:25){
    assign(paste("EGFR_Uni",i,j,sep = "_"), my.union(get(paste("EGFR_paths_",i,sep = "")),get(paste("EGFR_paths_",j,sep = ""))))
   }
}


# EGFR_Inters_i_j <- my.intersect(EGFR_paths_i,paths_j)
for (i in 1:25){
  for (j in 1:25){
    assign(paste("EGFR_Inters",i,j,sep = "_"), my.intersect(get(paste("EGFR_paths_",i,sep = "")),get(paste("EGFR_paths_",j,sep = ""))))
   }
}

# The EGFR_paired_ratio_i_j = nrow(EGFR_Inters_i_j)/nrow(EGFR_Uni_i_j)
for (i in 1:25){
  for (j in 1:25){
    assign(paste("EGFR_paired_ratio",i,j,sep = "_"), nrow(get(paste("EGFR_Inters",i,j,sep = "_")))/nrow(get(paste("EGFR_Uni",i,j,sep = "_"))))
   }
}


EGFR_paired_ratio_df <- list()
for (i in 1:25){
  for (j in 1:25){
    assign("EGFR_paired_ratio_df",append(EGFR_paired_ratio_df,get(paste("EGFR_paired_ratio",i,j,sep = "_"))))
    }
}

write.table(EGFR_paired_ratio_df, "EGFR_paired_ratio_df.txt")

EGFR_ratio_dataframe <- read.csv("EGFR_paired_ratio_df.csv",header = FALSE)
colnames(EGFR_ratio_dataframe) <- sample_25
rownames(EGFR_ratio_dataframe) <- sample_25
pheatmap::pheatmap(EGFR_ratio_dataframe)
```



# nrow(ALK_paths_i)/nrow(intersection of 25 samples)
```{r target = ALK}
# ALK_paths_i <- shortest.paths.to.target(ssi,target = "ALK)
for (i in 1:25){
  assign(paste("ALK_paths_",i,sep = ""),shortest.paths.to.target(get(paste("ss",i,sep = "")),target = "ALK"))
}

# ALK_intercet is the intersection of 25 ALK targeting samples
for (i in 1:25){
  ALK_intercet <- my.intersect(get(paste("ALK_paths_",i,sep = "")))
}

# ALK_Network <- graph.cfn.cccn (ALK_intercet, ld=FALSE, gz=TRUE, only.cfn=TRUE)
# all.ratio.styles()

# ALK_i_nrow_ratio <- nrow(ALK_paths_i)/nrow(ALK_intercet)
for (i in 1:25){
  assign(paste("ALK_",i,"_nrow_ratio", sep = ""),nrow(get(paste("ALK_paths_",i,sep = "")))/nrow(ALK_intercet))
}

# ALK_ratios <- list(ALK_i_nrow_ratio)
ALK_ratios <- list()

for (i in 1:25){
  assign("ALK_ratios", append(ALK_ratios,get(paste("ALK_",i,"_nrow_ratio", sep = ""))))
}  
  

ALK_Network <- graph.cfn.cccn (ALK_intercet, ld=FALSE, gz=TRUE, only.cfn=TRUE)
all.ratio.styles()


#creatign a dataframe to generate the heatmap
ALK_dataframe <- data.frame(ALK_ratios)
colnames(ALK_dataframe) <- cell_line
write.table(ALK_dataframe,"ALK.txt")
ALK <-read.csv("ALK.csv")
rownames(ALK) <- cell_line
colnames(ALK) <- cell_line
ALK <- ALK[2:26]
pheatmap::pheatmap(ALK)

```
# TARGET = ALK

```{r}
# ALK_Uni_i_j <- my.union(paths_i,paths_j)
for (i in 1:25){
  for (j in 1:25){
    assign(paste("ALK_Uni",i,j,sep = "_"), my.union(get(paste("ALK_paths_",i,sep = "")),get(paste("ALK_paths_",j,sep = ""))))
   }
}



# ALK_Inters_i_j <- my.intersect(ALK_paths_i,paths_j)
for (i in 1:25){
  for (j in 1:25){
    assign(paste("ALK_Inters",i,j,sep = "_"), my.intersect(get(paste("ALK_paths_",i,sep = "")),get(paste("ALK_paths_",j,sep = ""))))
   }
}

# The ALK_paired_ratio_i_j = nrow(ALK_Inters_i_j)/nrow(ALK_Uni_i_j)
for (i in 1:25){
  for (j in 1:25){
    assign(paste("ALK_paired_ratio",i,j,sep = "_"), nrow(get(paste("ALK_Inters",i,j,sep = "_")))/nrow(get(paste("ALK_Uni",i,j,sep = "_"))))
   }
}

#
ALK_paired_ratio_df <- list()
for (i in 1:25){
  for (j in 1:25){
    assign("ALK_paired_ratio_df",append(ALK_paired_ratio_df,get(paste("ALK_paired_ratio",i,j,sep = "_"))))
    }
}

write.table(ALK_paired_ratio_df, "ALK_paired_ratio_df.txt")



ALK_ratio_dataframe <- read.csv("ALK_paired_ratio_df.csv",header = FALSE)

colnames(ALK_ratio_dataframe) <- cell_line
rownames(ALK_ratio_dataframe) <- cell_line
pheatmap::pheatmap(ALK_ratio_dataframe)
```




# Here matrix that composed of target(x) and cell line(y)

```{r}
General_matrix <- data.frame(met = c(MET_ratios)
                             , egfr = c(EGFR_ratios)
                             , alk = c(ALK_ratios))
General_matrix <- t(General_matrix)
colnames(General_matrix) <- cell_line
heatmap(General_matrix)
```


When you save the notebook, an HTML file containing the code and output will be saved alongside it (click the *Preview* button or press *Cmd+Shift+K* to preview the HTML file). 

The preview shows you a rendered HTML copy of the contents of the editor. Consequently, unlike *Knit*, *Preview* does not run any R code chunks. Instead, the output of the chunk when it was last run in the editor is displayed.

